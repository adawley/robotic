<!DOCTYPE html>
<html>
    <head>
        <title>worker test</title>
    </head>

    <body>
        <div>
            <p>Count numbers: <output id="worker_count"></output></p>
            <button onclick="workers.add()">Add Worker</button> 
            <button onclick="workers.remove()">Stop Worker</button>
            <button onclick="alert(workers.count());">show count</button>
            <button onclick="workers.names();">show names</button>
            <button onclick="workers.weights();">show weights</button>
            <br /><br />

            <script>
                
                /*
                 * Array object prototypes
                 */
                Array.prototype.map = function(callback){
                    var i = 0;
                    for(;i<this.length;i++){
                        callback(this[i]);
                    }
                }
                
                /*
                 * Worker object prototypes
                 */
                 
                Worker.prototype.init = function(name, weight){
                    // set the message listener
                    this.onmessage = function (event) {
                        document.getElementById("result").innerHTML+=event.data+'<br>';
                    };
                    this.name(name);
                    this.weight(weight);
                }
                
                Worker.prototype.name = function(name){
                    name = (typeof(name) === "undefined") ? '' : name;
                    this.postMessage({'cmd':'name','msg': name});
                }
                Worker.prototype.stop = function(){
                    this.postMessage({'cmd':'stop'});
                }
                Worker.prototype.weight = function(weight){
                    weight = (typeof(weight) === "undefined") ? '' : weight;
                    this.postMessage({'cmd':'weight','msg': weight});
                }
                
                /*
                 * A wrapper to handle multiple workers
                 */
                function workers(){
                    
                }           
                
                /*
                 * Sets count
                 * returns count
                 */
                workers.count = function(){
                    var l = workers.cata.length;
                    document.getElementById("worker_count").innerHTML = l;
                    return l;
                }
                
                /*
                 * The catalog of workers
                 */
                workers.cata = new Array();
                
                /*
                 * Add a worker
                 * returns the new worker.
                 */
                workers.add = function(){
                    var w=new Worker("worker.js");
                    
                    var weight=Math.floor(Math.random()*11)+1;
                    w.init(new Date().getTime(), weight);
                   
                    // add it to the stack
                    workers.cata.push(w);
                    
                    // trigger a count update
                    workers.count();
                    
                    return w;
                }
                
                /*
                 * Gets the names of the current workers.
                 */
                workers.names = function(){
                    workers.cata.map(function(w){
                        w.name();
                    });
                }
                
                /*
                 * Stops then removes the specified worker. If no worker is 
                 * passed then the last worker is removed.
                 */
                workers.remove = function(worker){
                    // if no worker is passed pop off the last worker
                    if(typeof(worker) === "undefined"){
                        worker = workers.cata.pop();
                    }else {
                        workers.cata.splice(workers.cata.indexOf(worker),1);
                    }
                    
                    worker.stop();
                    workers.count();
                }
                
                /*
                 * Gets the weights of the current workers.
                 */
                workers.weights = function(){
                    workers.cata.map(function(w){
                        w.weight();
                    });
                }



            </script>

        </div>
        <button onclick="document.getElementById('result').innerHTML='';">clear buffer</button><br>
        <output id="result" style="width: 80em;border: 1px solid black"></output>
    </body>
</html>

